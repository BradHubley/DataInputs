---
title: "NLsurvey"
author: "Danni Harper"
date: "5/13/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
 library(Mar.datawrangling)
 library(tidyverse)
 library(lubridate)
 library(stringr)

datadir="C:/Users/harperd/Documents/Halibut/RDataVault/NLdata_received2021"
#datadir="C:/Users/hubleyb/Documents/Halibut/data/Newfoundland Data/Newfoundland RV Data - Received 2021"
wd="C:/Users/harperd/Documents/Halibut/GitDataInputs/DataInputs/"
source(file.path(wd, "passwords.r"))
```

This rmd will be working through the NL RV survey data that was requested in 2021. These csvs only contain data from surveys completed post 1995/1996, the most recent gear change.

Thing to consider when looking at the data with respect to the halibut management area (no mention of areas outside that):
- we only have the spring survey data (missing autumn survey data, should we get it?)
- changes in vessels and gear over the time series:
      - 1971 - 1982: vessel=A.T. Cameron; gear=Yankee-41.5 otter trawl
      - 1983 - 1995: vessel=A.T. Cameron replaced 1984 with Alfred Needler; gear=Engels-145 high-lift otter trawl
      - 1996 - present: vessel=combination of Alfred Needler and Telost; gear=Campelen 1800 shrimp trawl
- 3Ps and 3Pn included in survey in 1972
- some missing survey coverage over the recent time series to note:
      - 2006: no sampling in 3Ps + minimal in 3NO
      - 2014: down 64 sets (mainly within 3NOPs)
      - 2018: 3 strata missing in 3Ps
      - 2019: 1 stratum missing in 3O
- no 2020 data or idea of how that survey went (should I ask for it?)
- the number of overall sets for the Spring Survey has been declining since 2014 (most drastically in 2014, 2016, 2019)
      - still enough to consider strata completed

```{r}
NL_hal_LFraw <- read.csv(file.path(datadir,"NL_AtlanticHalibut_LF.csv"))

NLstrat_length_abundance_detail <- read.csv(file.path(datadir,"NLstrat1_length_abundance_details.csv"))

NLstrat_length_abundance_summary <- read.csv(file.path(datadir,"NLstrat1_length_abundance_summary.csv"))

NLstrat_lengthyear_meanabundance_matrix <- read.csv(file.path(datadir,"NLstrat1_length_year_mean_abundance_matrix.csv"))

NLstrat_lengthyear_totalabundance_matrix <- read.csv(file.path(datadir,"NLstrat1_length_year_total_abundance_matrix.csv"))

NLstrat_abundance_detail <- read.csv(file.path(datadir,"NLstrat2_abundance_details.csv"))

NLstrat_abundance_summary <- read.csv(file.path(datadir,"NLstrat2_abundance_summary.csv"))

NLstrat_biomass_detail <- read.csv(file.path(datadir,"NLstrat2_biomass_details.csv"))

NLstrat_biomass_summary <- read.csv(file.path(datadir,"NLstrat2_biomass_summary.csv"))
```

NL_hal_LFraw is just from 2008-2019
```{r}
NLstrat_length_abundance_detail %>% filter(NAFOdiv == "3N") %>%
ggplot() +
   geom_density(aes(length), fill = "lightblue") + 
   facet_grid(survey.year~.)

NLstrat_length_abundance_detail %>% filter(NAFOdiv == "3O") %>%
ggplot() +
   geom_density(aes(length), fill = "lightblue") + 
   facet_grid(survey.year~.)

NLstrat_length_abundance_detail %>% filter(NAFOdiv == "3P") %>%
ggplot() +
   geom_density(aes(length), fill = "lightblue") + 
   facet_grid(survey.year~.)

NLstrat_length_abundance_detail %>% count(NAFOdiv)

NLstrat_length_abundance_detail %>% count(survey.year, NAFOdiv)

#shows where no halibut caught by year and nafo (keeping in mind that no sets were completed in 3P and minimal in 3NO in 2006, minimal coverage in 2014)
   ##that makes no sense since 4 halibut were caught in 3P in 2006 (could this be including 3Pn?)
ggplot(NLstrat_length_abundance_detail) +
   geom_histogram(aes(survey.year, stat = "count"), binwidth = 1) +
   facet_wrap(~NAFOdiv)


```

Quick look at overall length frequencies by year
```{r}
ggplot(NLstrat_length_abundance_summary) +
   geom_col(aes(length, total)) +
   facet_wrap(~survey.year, scales = "free")
```

Binning length data (what goes in "num.at.len = ")
```{r}
NL_binlength <- binNumAtLen(num.at.len = NLstrat_length_abundance_detail$obs, len = NLstrat_length_abundance_detail$length, bins = seq(0, 260, 5))

view(NL_binlength)
```

Graph of stratified length/abundance (detailed)
```{r}
ggplot(NLstrat_length_abundance_detail) +
   geom_col(aes(length, obs)) +
   theme_classic()
```

Binned (but including the 3 sex categories, which is wrong right?)...artificially inflated by repeat values in female+male+unsexed
```{r}
NL_binlengthT <- as.data.frame(NL_binlength)

NL_binlengthT <- tibble::rownames_to_column(NL_binlengthT, "length")

NL_binlengthT <- NL_binlengthT %>%
   rename(count = NL_binlength)

NL_binlengthT$length<-gsub("L"," ", as.character(NL_binlengthT$length))

NL_binlengthT$length <- as.numeric(NL_binlengthT$length)


ggplot(NL_binlengthT) +
   geom_col(aes(length, count)) +
   xlim(0, 200) + 
   theme_classic()
```

Checking same as above but with only female+male+unsexed
```{r}
NL_datUS <- NLstrat_length_abundance_detail %>%
   filter(sex == "female+male+unsexed")

NL_binlengthUS <- binNumAtLen(num.at.len = NL_datUS$obs, len = NL_datUS$length, bins = seq(0, 260, 5))

NL_binlengthUS.tab <- as.data.frame(NL_binlengthUS)

NL_binlengthUS.tab <- tibble::rownames_to_column(NL_binlengthUS.tab, "length")

NL_binlengthUS.tab <- NL_binlengthUS.tab %>%
   rename(count = NL_binlengthUS)

NL_binlengthUS.tab$length<-gsub("L"," ", as.character(NL_binlengthUS.tab$length))

NL_binlengthUS.tab$length <- as.numeric(NL_binlengthUS.tab$length)


ggplot(NL_binlengthUS.tab) +
   geom_col(aes(length, count)) +
   xlim(0, 200) +
   theme_classic()
```


Graph same data as above but just 1996-2013 
```{r}
NL_predatUS <- NL_datUS %>%
   filter(between(survey.year, 1996, 2013))


NL_binpreUS <- binNumAtLen(num.at.len = NL_predatUS$obs, len = NL_predatUS$length, bins = seq(0, 260, 5))

NL_binpreUS.tab <- as.data.frame(NL_binpreUS)

NL_binpreUS.tab <- tibble::rownames_to_column(NL_binpreUS.tab, "length")

NL_binpreUS.tab <- NL_binpreUS.tab %>%
   rename(count = NL_binpreUS)

NL_binpreUS.tab$length<-gsub("L"," ", as.character(NL_binpreUS.tab$length))

NL_binpreUS.tab$length <- as.numeric(NL_binpreUS.tab$length)


ggplot(NL_binpreUS.tab) +
   geom_col(aes(length, count)) +
   xlim(0, 200) +
   theme_classic()

```

Graph same data as above but just 1996-2013 with 3cm bins to try to match previous plot
```{r}
NL_predatUS <- NL_datUS %>%
   filter(between(survey.year, 1996, 2013))


NL_bin3preUS <- binNumAtLen(num.at.len = NL_predatUS$obs, len = NL_predatUS$length, bins = seq(0, 200, 3))

NL_binpre3US.tab <- as.data.frame(NL_bin3preUS)

NL_binpre3US.tab <- tibble::rownames_to_column(NL_binpre3US.tab, "length")

NL_binpre3US.tab <- NL_binpre3US.tab %>%
   rename(count = NL_bin3preUS)

NL_binpre3US.tab$length<-gsub("L"," ", as.character(NL_binpre3US.tab$length))

NL_binpre3US.tab$length <- as.numeric(NL_binpre3US.tab$length)


ggplot(NL_binpre3US.tab) +
   geom_col(aes(length, count)) +
   scale_x_continuous(breaks=seq(2,200,6)) +
   theme_classic()

```
Fish caught by length for most recent time period (2014-2019)
```{r}
NL_datNEW <- NL_datUS %>%
   filter(between(survey.year, 2014, 2019))


NL_bindatNEW <- binNumAtLen(num.at.len = NL_datNEW$obs, len = NL_datNEW$length, bins = seq(0, 260, 5))

NL_bindatNEW.tab <- as.data.frame(NL_bindatNEW)

NL_bindatNEW.tab <- tibble::rownames_to_column(NL_bindatNEW.tab, "length")

NL_bindatNEW.tab <- NL_bindatNEW.tab %>%
   rename(count = NL_bindatNEW)

NL_bindatNEW.tab$length<-gsub("L"," ", as.character(NL_bindatNEW.tab$length))

NL_bindatNEW.tab$length <- as.numeric(NL_bindatNEW.tab$length)


ggplot(NL_bindatNEW.tab) +
   geom_col(aes(length, count)) +
   xlim(0, 200) +
   theme_classic()
```
Producing length frequency plots for every year (1996-2019)
```{r}
#example plot 
NL_1996 <- NL_datUS %>%
   filter(survey.year == 1996)

NL_bin1996 <- binNumAtLen(num.at.len = NL_1996$totals, len = NL_1996$length, bins = seq(0, 260, 5))

NL_bin1996.tab <- as.data.frame(NL_bin1996)

NL_bin1996.tab <- tibble::rownames_to_column(NL_bin1996.tab, "length")

NL_bin1996.tab <- NL_bin1996.tab %>%
   rename(totals = NL_bin1996)

NL_bin1996.tab$length<-gsub("L"," ", as.character(NL_bin1996.tab$length))

NL_bin1996.tab$length <- as.numeric(NL_bin1996.tab$length)

ggplot(NL_bin1996.tab) +
   geom_col(aes(length, totals)) +
   xlim(0, 200) +
   theme_classic()

#1997
NL_1997 <- NL_datUS %>%
   filter(survey.year == 1997)

NL_bin1997 <- binNumAtLen(num.at.len = NL_1997$totals, len = NL_1997$length, bins = seq(0, 260, 5))

NL_bin1997.tab <- as.data.frame(NL_bin1997)

NL_bin1997.tab <- tibble::rownames_to_column(NL_bin1997.tab, "length")

NL_bin1997.tab <- NL_bin1997.tab %>%
   rename(totals = NL_bin1997)

NL_bin1997.tab$length<-gsub("L"," ", as.character(NL_bin1997.tab$length))

NL_bin1997.tab$length <- as.numeric(NL_bin1997.tab$length)

ggplot(NL_bin1997.tab) +
   geom_col(aes(length, totals)) +
   xlim(0, 200) +
   theme_classic()
```

Making above plots for older data set (to include all available data)
```{r}
#reading in old data
#missing LF data from 1971, 1992, 1993

NL_1972_1991 <- read.csv("R:/Science/Population Ecology Division/Shared/Atlantic Halibut/Assessments & Updates/2021 Framework/Data/Newfoundland Data/3cm_lfs_1973_1991.csv")

NL_1994_2007 <- read.csv("R:/Science/Population Ecology Division/Shared/Atlantic Halibut/Assessments & Updates/2021 Framework/Data/Newfoundland Data/1cm_lfs_1994_2007.csv")

#getting only data we need from NL_1972_1991
NL_1972_1991 <- NL_1972_1991 %>%
   filter(Species == "893", Division %in% c("3N", "3O", "3P"), Month %in% c(3,4,5,6))

NL_1972_1991a <- NL_1972_1991 %>%
   pivot_longer(cols = 17:116, names_to = "length", values_to = "count")

NL_1972_1991a$length<-gsub("X"," ", as.character(NL_1972_1991a$length))

NL_1972_1991a$length <- as.numeric(NL_1972_1991a$length)

unique(NL_1972_1991a$Sex) #only 1 and 5, so no unsexed

unique(NL_1972_1991a$Year) #only 1973 to 1991, all good

#getting data finished up and graphing for 1972-198 (Yankee trawl data)
NL_yankeeLF <- NL_1972_1991a %>%
   filter(between(Year, 73, 82))

NL_yankeeLF <- binNumAtLen(num.at.len = NL_yankeeLF$count, len = NL_yankeeLF$length, bins = seq(0, 260, 5))

NL_yankeeLF.tab <- as.data.frame(NL_yankeeLF)

NL_yankeeLF.tab <- tibble::rownames_to_column(NL_yankeeLF.tab, "length")

NL_yankeeLF.tab <- NL_yankeeLF.tab %>%
   rename(count = NL_yankeeLF)

NL_yankeeLF.tab$length<-gsub("L"," ", as.character(NL_yankeeLF.tab$length))

NL_yankeeLF.tab$length <- as.numeric(NL_yankeeLF.tab$length)


ggplot(NL_yankeeLF.tab) +
   geom_col(aes(length, count)) +
   xlim(0, 200) +
   theme_classic()

#binned LF data from 1983-1991
NL_Engel1 <- NL_1972_1991a %>%
   filter(between(Year, 83, 91))


NL_Engel1 <- binNumAtLen(num.at.len = NL_Engel1$count, len = NL_Engel1$length, bins = seq(0, 260, 5))

NL_Engel1.tab <- as.data.frame(NL_Engel1)

NL_Engel1.tab <- tibble::rownames_to_column(NL_Engel1.tab, "length")

NL_Engel1.tab <- NL_Engel1.tab %>%
   rename(count = NL_Engel1)

NL_Engel1.tab$length<-gsub("L"," ", as.character(NL_Engel1.tab$length))

NL_Engel1.tab$length <- as.numeric(NL_Engel1.tab$length)

#getting data for rest of engel series (1994, 1995)
NL_1994_2007 <- NL_1994_2007 %>%
   filter(Species == "893", Division %in% c("3N", "3O", "3P"), Month %in% c(3,4,5,6), Year %in% c(94, 95))

NL_1994_2007a <- NL_1994_2007 %>%
   pivot_longer(cols = 17:216, names_to = "length", values_to = "count")

NL_1994_2007a$length<-gsub("X"," ", as.character(NL_1994_2007a$length))

NL_1994_2007a$length <- as.numeric(NL_1994_2007a$length)

unique(NL_1994_2007a$Sex) #only 1 and 5, so no unsexed

unique(NL_1994_2007a$Year) #only 1994 and 1995, all good

#getting data finished up for 1994 and 1995 (Engel trawl data)
NL_Engel2<- NL_1994_2007a

NL_Engel2 <- binNumAtLen(num.at.len = NL_Engel2$count, len = NL_Engel2$length, bins = seq(0, 260, 5))

NL_Engel2.tab <- as.data.frame(NL_Engel2)

NL_Engel2.tab <- tibble::rownames_to_column(NL_Engel2.tab, "length")

NL_Engel2.tab <- NL_Engel2.tab %>%
   rename(count = NL_Engel2)

NL_Engel2.tab$length<-gsub("L"," ", as.character(NL_Engel2.tab$length))

NL_Engel2.tab$length <- as.numeric(NL_Engel2.tab$length)

#bring Engel data together to graph
NL_engelLF <- NL_Engel1.tab %>%
   left_join(NL_Engel2.tab, by = "length") %>%
   mutate(count = count.x + count.y) %>%
   select(-"count.x", -"count.y")

ggplot(NL_engelLF) +
   geom_col(aes(length, count)) +
   xlim(0, 200) +
   theme_classic()

```
Overall LF panel, including the 3 separate time series
```{r}
NL_LFoverall <- NL_bindatNEW.tab %>% 
   left_join(NL_binpreUS.tab, by = "length") %>%
   left_join(NL_yankeeLF.tab, by = "length") %>%
   left_join(NL_engelLF, by = "length") %>%
   rename("Yankee" = count.x.x, "Engel" = count.y.y, "Campelen1" = count.y, "Campelen2" = count.x)

NL_LFoverall <- NL_LFoverall %>%
   pivot_longer(cols = 2:5, names_to = "gear", values_to = "count") 

NL_LFoverall_labels <- data.frame(gear = c("Yankee", "Engel", "Campelen1", "Campelen2"), label = c("1973-1982", "1983-1991, 1994, 1995", "1996-2013", "2014-2019"))

NL_LFoverall$gear <- factor(NL_LFoverall$gear, levels = c("Yankee", "Engel", "Campelen1", "Campelen2"))

Camp1 <- ggplot(NL_LFoverall) +
   geom_col(aes(length, Campelen2)) +
   xlim(0, 200) 

yankee <- ggplot(NL_LFoverall) +
   geom_col(aes(length, yankee)) +
   xlim(0, 200) 

install.packages("ggpubr")
library("ggpubr")

C2<-ggplot(NL_LFoverall) +
   geom_col(aes(length, Campelen2)) +
   xlim(0, 200)+
   labs(title = "3NOP RV Survey 2014-2019 Combined")+
   xlab("") + ylab("")+
   theme_classic()
   
C1<-ggplot(NL_LFoverall) +
   geom_col(aes(length, Campelen1)) +
   xlim(0, 200)+
   labs(title = "3NOP RV Survey 1996-2013 Combined")+
   xlab("") + ylab("")+
   theme_classic()

Y<-ggplot(NL_LFoverall) +
   geom_col(aes(length, Yankee)) +
   xlim(0, 200)+
   labs(title = "3NOP RV Survey 1973-1982 Combined")+
   xlab("") + ylab("")+
   theme_classic()

E<-ggplot(NL_LFoverall) +
   geom_col(aes(length, Engel)) +
   xlim(0, 200)+
   labs(title = "3NOP RV Survey 1983-1991, 1994, and 1995 Combined")+
   xlab("") + ylab("")+
   theme_classic()

overall <- ggarrange(Y, E, C1, C2, ncol = 1, nrow = 4)

overall <- annotate_figure(overall, left = "Numbers at Length", bottom = "Length Bin Midpoint")
```


Using matrix provided, trying to bin and plot. Data for Brad! Also data I will plot my year
```{r}
NL_bin1996totals <- binNumAtLen(num.at.len = NLstrat_lengthyear_totalabundance_matrix$y1996, len = NLstrat_lengthyear_totalabundance_matrix$length, bins = seq(0, 260, 5))

NL_bin1997totals <- binNumAtLen(num.at.len = NLstrat_lengthyear_totalabundance_matrix$y1997, len = NLstrat_lengthyear_totalabundance_matrix$length, bins = seq(0, 260, 5))

NL_bin1998totals <- binNumAtLen(num.at.len = NLstrat_lengthyear_totalabundance_matrix$y1998, len = NLstrat_lengthyear_totalabundance_matrix$length, bins = seq(0, 260, 5))

NL_bin1999totals <- binNumAtLen(num.at.len = NLstrat_lengthyear_totalabundance_matrix$y1999, len = NLstrat_lengthyear_totalabundance_matrix$length, bins = seq(0, 260, 5))

NL_bin2000totals <- binNumAtLen(num.at.len = NLstrat_lengthyear_totalabundance_matrix$y2000, len = NLstrat_lengthyear_totalabundance_matrix$length, bins = seq(0, 260, 5))

NL_bin2001totals <- binNumAtLen(num.at.len = NLstrat_lengthyear_totalabundance_matrix$y2001, len = NLstrat_lengthyear_totalabundance_matrix$length, bins = seq(0, 260, 5))

NL_bin2002totals <- binNumAtLen(num.at.len = NLstrat_lengthyear_totalabundance_matrix$y2002, len = NLstrat_lengthyear_totalabundance_matrix$length, bins = seq(0, 260, 5))

NL_bin2003totals <- binNumAtLen(num.at.len = NLstrat_lengthyear_totalabundance_matrix$y2003, len = NLstrat_lengthyear_totalabundance_matrix$length, bins = seq(0, 260, 5))

NL_bin2004totals <- binNumAtLen(num.at.len = NLstrat_lengthyear_totalabundance_matrix$y2004, len = NLstrat_lengthyear_totalabundance_matrix$length, bins = seq(0, 260, 5))

NL_bin2005totals <- binNumAtLen(num.at.len = NLstrat_lengthyear_totalabundance_matrix$y2005, len = NLstrat_lengthyear_totalabundance_matrix$length, bins = seq(0, 260, 5))

NL_bin2006totals <- binNumAtLen(num.at.len = NLstrat_lengthyear_totalabundance_matrix$y2006, len = NLstrat_lengthyear_totalabundance_matrix$length, bins = seq(0, 260, 5))

NL_bin2007totals <- binNumAtLen(num.at.len = NLstrat_lengthyear_totalabundance_matrix$y2007, len = NLstrat_lengthyear_totalabundance_matrix$length, bins = seq(0, 260, 5))

NL_bin2008totals <- binNumAtLen(num.at.len = NLstrat_lengthyear_totalabundance_matrix$y2008, len = NLstrat_lengthyear_totalabundance_matrix$length, bins = seq(0, 260, 5))

NL_bin2009totals <- binNumAtLen(num.at.len = NLstrat_lengthyear_totalabundance_matrix$y2009, len = NLstrat_lengthyear_totalabundance_matrix$length, bins = seq(0, 260, 5))

NL_bin2010totals <- binNumAtLen(num.at.len = NLstrat_lengthyear_totalabundance_matrix$y2010, len = NLstrat_lengthyear_totalabundance_matrix$length, bins = seq(0, 260, 5))

NL_bin2011totals <- binNumAtLen(num.at.len = NLstrat_lengthyear_totalabundance_matrix$y2011, len = NLstrat_lengthyear_totalabundance_matrix$length, bins = seq(0, 260, 5))

NL_bin2012totals <- binNumAtLen(num.at.len = NLstrat_lengthyear_totalabundance_matrix$y2012, len = NLstrat_lengthyear_totalabundance_matrix$length, bins = seq(0, 260, 5))

NL_bin2013totals <- binNumAtLen(num.at.len = NLstrat_lengthyear_totalabundance_matrix$y2013, len = NLstrat_lengthyear_totalabundance_matrix$length, bins = seq(0, 260, 5))

NL_bin2014totals <- binNumAtLen(num.at.len = NLstrat_lengthyear_totalabundance_matrix$y2014, len = NLstrat_lengthyear_totalabundance_matrix$length, bins = seq(0, 260, 5))

NL_bin2015totals <- binNumAtLen(num.at.len = NLstrat_lengthyear_totalabundance_matrix$y2015, len = NLstrat_lengthyear_totalabundance_matrix$length, bins = seq(0, 260, 5))

NL_bin2016totals <- binNumAtLen(num.at.len = NLstrat_lengthyear_totalabundance_matrix$y2016, len = NLstrat_lengthyear_totalabundance_matrix$length, bins = seq(0, 260, 5))

NL_bin2017totals <- binNumAtLen(num.at.len = NLstrat_lengthyear_totalabundance_matrix$y2017, len = NLstrat_lengthyear_totalabundance_matrix$length, bins = seq(0, 260, 5))

NL_bin2018totals <- binNumAtLen(num.at.len = NLstrat_lengthyear_totalabundance_matrix$y2018, len = NLstrat_lengthyear_totalabundance_matrix$length, bins = seq(0, 260, 5))

NL_bin2019totals <- binNumAtLen(num.at.len = NLstrat_lengthyear_totalabundance_matrix$y2019, len = NLstrat_lengthyear_totalabundance_matrix$length, bins = seq(0, 260, 5))

NL_bintotals.tab <- data.frame(yr1996 = NL_bin1996totals, yr1997 = NL_bin1997totals, yr1998 = NL_bin1998totals, yr1999 = NL_bin1999totals, yr2000 = NL_bin2000totals, yr2001 = NL_bin2001totals, yr2002 = NL_bin2002totals, yr2003 = NL_bin2003totals, yr2004 = NL_bin2004totals, yr2005 = NL_bin2005totals, yr2006 = NL_bin2006totals, yr2007 = NL_bin2007totals, yr2008 = NL_bin2008totals, yr2009 = NL_bin2009totals, yr2010 = NL_bin2010totals, yr2011 = NL_bin2011totals, yr2012 = NL_bin2012totals, yr2013 = NL_bin2013totals, yr2014 = NL_bin2014totals, yr2015 = NL_bin2015totals, yr2016 = NL_bin2016totals, yr2017 = NL_bin2017totals, yr2018 = NL_bin2018totals, yr2019 = NL_bin2019totals)

NL_bintotals.tab <- tibble::rownames_to_column(NL_bintotals.tab, "length")

NL_bintotals.tab$length<-gsub("L"," ", as.character(NL_bintotals.tab$length))

NL_bintotals.tab$length <- as.numeric(NL_bintotals.tab$length)

NL_bintotals.tabLong <- gather(NL_bintotals.tab, "year", "totals", -"length")


ggplot(NL_bintotals.tabLong) +
   geom_col(aes(length, totals)) +
   xlim(0, 200) +
   facet_wrap(~year)+
   scale_y_continuous(labels = scales::comma) +
   theme_bw() + 
   theme(panel.grid.major = element_blank(),
         panel.grid.minor = element_blank())

library(data.table)

NL_bintotals.tab2 <- transpose(NL_bintotals.tab, keep.names = "yr", make.names = "length")

NL_bintotals.tab2$yr <- gsub("yr"," ", as.character(NL_bintotals.tab2$yr))

NL_bintotals.tab2 <- NL_bintotals.tab2 %>%
   rename(year = yr)

write.csv(NL_bintotals.tab2, "C:/Users/harperd/Documents/Halibut/GitDataInputs/NL_lengthdata_binned.csv", row.names = FALSE)
```

Observation (sample size) data for Brad
```{r}
NL_ss <- NLstrat_length_abundance_detail %>%
   select("survey.year", "sex", "obs")

NL_ss <- NL_ss %>%
   group_by(survey.year, sex) %>%
   summarize(n=n())

write.csv(NL_ss, "C:/Users/harperd/Documents/Halibut/GitDataInputs/NLsurvey_n_yrsex.csv", row.names = FALSE)

NL_ss_nosex <- NL_ss %>%
   group_by(survey.year) %>%
   summarize(n=n())
write.csv(NL_ss_nosex, "C:/Users/harperd/Documents/Halibut/GitDataInputs/NLsurvey_n_yr.csv", row.names = FALSE)
```

Sample units per year for Brad
```{r}
NL_su <- NLstrat_length_abundance_detail %>%
   select("survey.year", "strat", "sample.units")

NL_su <- NL_su %>%
   group_by(survey.year, strat) %>%
   summarize(sample.units = max(sample.units))

NL_su <- NL_su %>%
   select(-strat) %>%
   group_by(survey.year) %>%
   summarize(towable.units = sum(sample.units))

write.csv(NL_su, "C:/Users/harperd/Documents/Halibut/GitDataInputs/NL_towableunits_yr.csv", row.names = FALSE)

```



Finding mean fish per tow using the summary data
```{r}
ggplot(NLstrat_abundance_summary, aes(survey.year, mean)) +
   geom_line(size = 1.5, colour = "grey") +
   geom_errorbar(aes(ymin = mean.lcl, ymax = mean.ucl))+
   scale_y_continuous(breaks=seq(0,0.4,0.1)) +
   theme_classic()
```

Finding mean fish per tow using the summary data to replicate previous data (1996-2013)
```{r}
NLstrat_abundance_summary_pre <- NLstrat_abundance_summary %>%
   filter(between(survey.year, 1996, 2013))

ggplot(NLstrat_abundance_summary_pre, aes(survey.year, mean)) +
   geom_line(size = 1.5, colour = "grey") +
   geom_errorbar(aes(ymin = mean.lcl, ymax = mean.ucl))+
   scale_y_continuous(breaks=seq(0,0.4,0.1)) +
   theme_classic()
```
means for new data
```{r}
summary(NL_datNEW$length)

#pre 2014

NL_dat1996_2013 <- NL_datUS %>%
   filter(between(survey.year, 1996, 2013))

summary(NL_dat1996_2013$length)

#all Campelen
summary(NL_datUS$length)
```

updating abundance table by sex
```{r}
NL_females <- NLstrat_length_abundance_detail %>%
   filter(sex == "female")

NL_males <- NLstrat_length_abundance_detail %>%
   filter(sex == "male")

NL_unsexed <- NLstrat_length_abundance_detail %>%
   filter(sex == "unsexed")

NL_females <- NL_females %>%
   select(survey.year, obs) %>%
   group_by(survey.year) %>%
   summarise(n())
View(NL_females)

NL_males <- NL_males %>%
   select(survey.year, obs) %>%
   group_by(survey.year) %>%
   summarise(n())
View(NL_males)

NL_unknowns <- NL_unsexed %>%
   select(survey.year, obs) %>%
   group_by(survey.year) %>%
   summarise(n())
View(NL_unknowns)

```

Observed sample size length frequency by sex
```{r}
#female
NL_n_f <- NLstrat_length_abundance_detail %>% filter(sex == "female")
NLf1996 <- NL_n_f %>% filter(survey.year == 1996)
NLf1997 <- NL_n_f %>% filter(survey.year == 1997)
NLf1998 <- NL_n_f %>% filter(survey.year == 1998)
NLf1999 <- NL_n_f %>% filter(survey.year == 1999)
NLf2000 <- NL_n_f %>% filter(survey.year == 2000)
NLf2001 <- NL_n_f %>% filter(survey.year == 2001)
NLf2002 <- NL_n_f %>% filter(survey.year == 2002)
NLf2003 <- NL_n_f %>% filter(survey.year == 2003)
NLf2004 <- NL_n_f %>% filter(survey.year == 2004)
NLf2005 <- NL_n_f %>% filter(survey.year == 2005)
NLf2006 <- NL_n_f %>% filter(survey.year == 2006)
NLf2007 <- NL_n_f %>% filter(survey.year == 2007)
NLf2008 <- NL_n_f %>% filter(survey.year == 2008)
NLf2009 <- NL_n_f %>% filter(survey.year == 2009)
NLf2010 <- NL_n_f %>% filter(survey.year == 2010)
NLf2011 <- NL_n_f %>% filter(survey.year == 2011)
NLf2012 <- NL_n_f %>% filter(survey.year == 2012)
NLf2013 <- NL_n_f %>% filter(survey.year == 2013)
NLf2014 <- NL_n_f %>% filter(survey.year == 2014)
NLf2015 <- NL_n_f %>% filter(survey.year == 2015)
NLf2016 <- NL_n_f %>% filter(survey.year == 2016)
NLf2017 <- NL_n_f %>% filter(survey.year == 2017)
NLf2018 <- NL_n_f %>% filter(survey.year == 2018)
NLf2019 <- NL_n_f %>% filter(survey.year == 2019)

NLf1996bin <- binNumAtLen(num.at.len = NLf1996$obs, len = NLf1996$length, bins = seq(0, 260, 5))
NLf1997bin <- binNumAtLen(num.at.len = NLf1997$obs, len = NLf1997$length, bins = seq(0, 260, 5))
NLf1998bin <- binNumAtLen(num.at.len = NLf1998$obs, len = NLf1998$length, bins = seq(0, 260, 5))
NLf1999bin <- binNumAtLen(num.at.len = NLf1999$obs, len = NLf1999$length, bins = seq(0, 260, 5))
NLf2000bin <- binNumAtLen(num.at.len = NLf2000$obs, len = NLf2000$length, bins = seq(0, 260, 5))
NLf2001bin <- binNumAtLen(num.at.len = NLf2001$obs, len = NLf2001$length, bins = seq(0, 260, 5))
NLf2002bin <- binNumAtLen(num.at.len = NLf2002$obs, len = NLf2002$length, bins = seq(0, 260, 5))
NLf2003bin <- binNumAtLen(num.at.len = NLf2003$obs, len = NLf2003$length, bins = seq(0, 260, 5))
NLf2004bin <- binNumAtLen(num.at.len = NLf2004$obs, len = NLf2004$length, bins = seq(0, 260, 5))
NLf2005bin <- binNumAtLen(num.at.len = NLf2005$obs, len = NLf2005$length, bins = seq(0, 260, 5))
NLf2006bin <- binNumAtLen(num.at.len = NLf2006$obs, len = NLf2006$length, bins = seq(0, 260, 5))
NLf2007bin <- binNumAtLen(num.at.len = NLf2007$obs, len = NLf2007$length, bins = seq(0, 260, 5))
NLf2008bin <- binNumAtLen(num.at.len = NLf2008$obs, len = NLf2008$length, bins = seq(0, 260, 5))
NLf2009bin <- binNumAtLen(num.at.len = NLf2009$obs, len = NLf2009$length, bins = seq(0, 260, 5))
NLf2010bin <- binNumAtLen(num.at.len = NLf2010$obs, len = NLf2010$length, bins = seq(0, 260, 5))
NLf2011bin <- binNumAtLen(num.at.len = NLf2011$obs, len = NLf2011$length, bins = seq(0, 260, 5))
NLf2012bin <- binNumAtLen(num.at.len = NLf2012$obs, len = NLf2012$length, bins = seq(0, 260, 5))
NLf2013bin <- binNumAtLen(num.at.len = NLf2013$obs, len = NLf2013$length, bins = seq(0, 260, 5))
NLf2014bin <- binNumAtLen(num.at.len = NLf2014$obs, len = NLf2014$length, bins = seq(0, 260, 5))
NLf2015bin <- binNumAtLen(num.at.len = NLf2015$obs, len = NLf2015$length, bins = seq(0, 260, 5))
NLf2016bin <- binNumAtLen(num.at.len = NLf2016$obs, len = NLf2016$length, bins = seq(0, 260, 5))
NLf2017bin <- binNumAtLen(num.at.len = NLf2017$obs, len = NLf2017$length, bins = seq(0, 260, 5))
NLf2018bin <- binNumAtLen(num.at.len = NLf2018$obs, len = NLf2018$length, bins = seq(0, 260, 5))
NLf2019bin <- binNumAtLen(num.at.len = NLf2019$obs, len = NLf2019$length, bins = seq(0, 260, 5))

NLf_binobs.tab <- data.frame(yr1996 = NLf1996bin, yr1997 = NLf1997bin, yr1998 = NLf1998bin, yr1999 = NLf1999bin, yr2000 = NLf2000bin, yr2001 = NLf2001bin, yr2002 = NLf2002bin, yr2003 = NLf2003bin, yr2004 = NLf2004bin, yr2005 = NLf2005bin, yr2006 = NLf2006bin, yr2007 = NLf2007bin, yr2008 = NLf2008bin, yr2009 = NLf2009bin, yr2010 = NLf2010bin, yr2011 = NLf2011bin, yr2012 = NLf2012bin, yr2013 = NLf2013bin, yr2014 = NLf2014bin, yr2015 = NLf2015bin, yr2016 = NLf2016bin, yr2017 = NLf2017bin, yr2018 = NLf2018bin, yr2019 = NLf2019bin)

NLf_binobs.tab <- tibble::rownames_to_column(NLf_binobs.tab, "length")

NLf_binobs.tab$length<-gsub("L"," ", as.character(NLf_binobs.tab$length))

NLf_binobs.tab$length <- as.numeric(NLf_binobs.tab$length)

NLf_binobs.tablong <- gather(NLf_binobs.tab, "year", "obs", -"length")
NLf_binobs.tablong$year<-gsub("yr"," ", as.character(NLf_binobs.tablong$year))

write.csv(NLf_binobs.tablong, "C:/Users/harperd/Documents/Halibut/GitDataInputs/NLsurvey_f_LF_obs.csv", row.names = FALSE)
#male

NL_n_m <- NLstrat_length_abundance_detail %>% filter(sex == "male")
NLm1996 <- NL_n_m %>% filter(survey.year == 1996)
NLm1997 <- NL_n_m %>% filter(survey.year == 1997)
NLm1998 <- NL_n_m %>% filter(survey.year == 1998)
NLm1999 <- NL_n_m %>% filter(survey.year == 1999)
NLm2000 <- NL_n_m %>% filter(survey.year == 2000)
NLm2001 <- NL_n_m %>% filter(survey.year == 2001)
NLm2002 <- NL_n_m %>% filter(survey.year == 2002)
NLm2003 <- NL_n_m %>% filter(survey.year == 2003)
NLm2004 <- NL_n_m %>% filter(survey.year == 2004)
NLm2005 <- NL_n_m %>% filter(survey.year == 2005)
NLm2006 <- NL_n_m %>% filter(survey.year == 2006)
NLm2007 <- NL_n_m %>% filter(survey.year == 2007)
NLm2008 <- NL_n_m %>% filter(survey.year == 2008)
NLm2009 <- NL_n_m %>% filter(survey.year == 2009)
NLm2010 <- NL_n_m %>% filter(survey.year == 2010)
NLm2011 <- NL_n_m %>% filter(survey.year == 2011)
NLm2012 <- NL_n_m %>% filter(survey.year == 2012)
NLm2013 <- NL_n_m %>% filter(survey.year == 2013)
NLm2014 <- NL_n_m %>% filter(survey.year == 2014)
NLm2015 <- NL_n_m %>% filter(survey.year == 2015)
NLm2016 <- NL_n_m %>% filter(survey.year == 2016)
NLm2017 <- NL_n_m %>% filter(survey.year == 2017)
NLm2018 <- NL_n_m %>% filter(survey.year == 2018)
NLm2019 <- NL_n_m %>% filter(survey.year == 2019)

NLm1996bin <- binNumAtLen(num.at.len = NLm1996$obs, len = NLm1996$length, bins = seq(0, 260, 5))
NLm1997bin <- binNumAtLen(num.at.len = NLm1997$obs, len = NLm1997$length, bins = seq(0, 260, 5))
NLm1998bin <- binNumAtLen(num.at.len = NLm1998$obs, len = NLm1998$length, bins = seq(0, 260, 5))
NLm1999bin <- binNumAtLen(num.at.len = NLm1999$obs, len = NLm1999$length, bins = seq(0, 260, 5))
NLm2000bin <- binNumAtLen(num.at.len = NLm2000$obs, len = NLm2000$length, bins = seq(0, 260, 5))
NLm2001bin <- binNumAtLen(num.at.len = NLm2001$obs, len = NLm2001$length, bins = seq(0, 260, 5))
NLm2002bin <- binNumAtLen(num.at.len = NLm2002$obs, len = NLm2002$length, bins = seq(0, 260, 5))
NLm2003bin <- binNumAtLen(num.at.len = NLm2003$obs, len = NLm2003$length, bins = seq(0, 260, 5))
NLm2004bin <- binNumAtLen(num.at.len = NLm2004$obs, len = NLm2004$length, bins = seq(0, 260, 5))
NLm2005bin <- binNumAtLen(num.at.len = NLm2005$obs, len = NLm2005$length, bins = seq(0, 260, 5))
NLm2006bin <- binNumAtLen(num.at.len = NLm2006$obs, len = NLm2006$length, bins = seq(0, 260, 5))
NLm2007bin <- binNumAtLen(num.at.len = NLm2007$obs, len = NLm2007$length, bins = seq(0, 260, 5))
NLm2008bin <- binNumAtLen(num.at.len = NLm2008$obs, len = NLm2008$length, bins = seq(0, 260, 5))
NLm2009bin <- binNumAtLen(num.at.len = NLm2009$obs, len = NLm2009$length, bins = seq(0, 260, 5))
NLm2010bin <- binNumAtLen(num.at.len = NLm2010$obs, len = NLm2010$length, bins = seq(0, 260, 5))
NLm2011bin <- binNumAtLen(num.at.len = NLm2011$obs, len = NLm2011$length, bins = seq(0, 260, 5))
NLm2012bin <- binNumAtLen(num.at.len = NLm2012$obs, len = NLm2012$length, bins = seq(0, 260, 5))
NLm2013bin <- binNumAtLen(num.at.len = NLm2013$obs, len = NLm2013$length, bins = seq(0, 260, 5))
NLm2014bin <- binNumAtLen(num.at.len = NLm2014$obs, len = NLm2014$length, bins = seq(0, 260, 5))
NLm2015bin <- binNumAtLen(num.at.len = NLm2015$obs, len = NLm2015$length, bins = seq(0, 260, 5))
NLm2016bin <- binNumAtLen(num.at.len = NLm2016$obs, len = NLm2016$length, bins = seq(0, 260, 5))
NLm2017bin <- binNumAtLen(num.at.len = NLm2017$obs, len = NLm2017$length, bins = seq(0, 260, 5))
NLm2018bin <- binNumAtLen(num.at.len = NLm2018$obs, len = NLm2018$length, bins = seq(0, 260, 5))
NLm2019bin <- binNumAtLen(num.at.len = NLm2019$obs, len = NLm2019$length, bins = seq(0, 260, 5))

NLm_binobs.tab <- data.frame(yr1996 = NLm1996bin, yr1997 = NLm1997bin, yr1998 = NLm1998bin, yr1999 = NLm1999bin, yr2000 = NLm2000bin, yr2001 = NLm2001bin, yr2002 = NLm2002bin, yr2003 = NLm2003bin, yr2004 = NLm2004bin, yr2005 = NLm2005bin, yr2006 = NLm2006bin, yr2007 = NLm2007bin, yr2008 = NLm2008bin, yr2009 = NLm2009bin, yr2010 = NLm2010bin, yr2011 = NLm2011bin, yr2012 = NLm2012bin, yr2013 = NLm2013bin, yr2014 = NLm2014bin, yr2015 = NLm2015bin, yr2016 = NLm2016bin, yr2017 = NLm2017bin, yr2018 = NLm2018bin, yr2019 = NLm2019bin)

NLm_binobs.tab <- tibble::rownames_to_column(NLm_binobs.tab, "length")

NLm_binobs.tab$length<-gsub("L"," ", as.character(NLm_binobs.tab$length))

NLm_binobs.tab$length <- as.numeric(NLm_binobs.tab$length)

NLm_binobs.tablong <- gather(NLm_binobs.tab, "year", "obs", -"length")
NLm_binobs.tablong$year<-gsub("yr"," ", as.character(NLm_binobs.tablong$year))

write.csv(NLm_binobs.tablong, "C:/Users/harperd/Documents/Halibut/GitDataInputs/NLsurvey_m_LF_obs.csv", row.names = FALSE)
#female+male+unsexed
NL_n_mfu <- NLstrat_length_abundance_detail %>% filter(sex == "female+male+unsexed")
NLmfu1996 <- NL_n_mfu %>% filter(survey.year == 1996)
NLmfu1997 <- NL_n_mfu %>% filter(survey.year == 1997)
NLmfu1998 <- NL_n_mfu %>% filter(survey.year == 1998)
NLmfu1999 <- NL_n_mfu %>% filter(survey.year == 1999)
NLmfu2000 <- NL_n_mfu %>% filter(survey.year == 2000)
NLmfu2001 <- NL_n_mfu %>% filter(survey.year == 2001)
NLmfu2002 <- NL_n_mfu %>% filter(survey.year == 2002)
NLmfu2003 <- NL_n_mfu %>% filter(survey.year == 2003)
NLmfu2004 <- NL_n_mfu %>% filter(survey.year == 2004)
NLmfu2005 <- NL_n_mfu %>% filter(survey.year == 2005)
NLmfu2006 <- NL_n_mfu %>% filter(survey.year == 2006)
NLmfu2007 <- NL_n_mfu %>% filter(survey.year == 2007)
NLmfu2008 <- NL_n_mfu %>% filter(survey.year == 2008)
NLmfu2009 <- NL_n_mfu %>% filter(survey.year == 2009)
NLmfu2010 <- NL_n_mfu %>% filter(survey.year == 2010)
NLmfu2011 <- NL_n_mfu %>% filter(survey.year == 2011)
NLmfu2012 <- NL_n_mfu %>% filter(survey.year == 2012)
NLmfu2013 <- NL_n_mfu %>% filter(survey.year == 2013)
NLmfu2014 <- NL_n_mfu %>% filter(survey.year == 2014)
NLmfu2015 <- NL_n_mfu %>% filter(survey.year == 2015)
NLmfu2016 <- NL_n_mfu %>% filter(survey.year == 2016)
NLmfu2017 <- NL_n_mfu %>% filter(survey.year == 2017)
NLmfu2018 <- NL_n_mfu %>% filter(survey.year == 2018)
NLmfu2019 <- NL_n_mfu %>% filter(survey.year == 2019)

NLmfu1996bin <- binNumAtLen(num.at.len = NLmfu1996$obs, len = NLmfu1996$length, bins = seq(0, 260, 5))
NLmfu1997bin <- binNumAtLen(num.at.len = NLmfu1997$obs, len = NLmfu1997$length, bins = seq(0, 260, 5))
NLmfu1998bin <- binNumAtLen(num.at.len = NLmfu1998$obs, len = NLmfu1998$length, bins = seq(0, 260, 5))
NLmfu1999bin <- binNumAtLen(num.at.len = NLmfu1999$obs, len = NLmfu1999$length, bins = seq(0, 260, 5))
NLmfu2000bin <- binNumAtLen(num.at.len = NLmfu2000$obs, len = NLmfu2000$length, bins = seq(0, 260, 5))
NLmfu2001bin <- binNumAtLen(num.at.len = NLmfu2001$obs, len = NLmfu2001$length, bins = seq(0, 260, 5))
NLmfu2002bin <- binNumAtLen(num.at.len = NLmfu2002$obs, len = NLmfu2002$length, bins = seq(0, 260, 5))
NLmfu2003bin <- binNumAtLen(num.at.len = NLmfu2003$obs, len = NLmfu2003$length, bins = seq(0, 260, 5))
NLmfu2004bin <- binNumAtLen(num.at.len = NLmfu2004$obs, len = NLmfu2004$length, bins = seq(0, 260, 5))
NLmfu2005bin <- binNumAtLen(num.at.len = NLmfu2005$obs, len = NLmfu2005$length, bins = seq(0, 260, 5))
NLmfu2006bin <- binNumAtLen(num.at.len = NLmfu2006$obs, len = NLmfu2006$length, bins = seq(0, 260, 5))
NLmfu2007bin <- binNumAtLen(num.at.len = NLmfu2007$obs, len = NLmfu2007$length, bins = seq(0, 260, 5))
NLmfu2008bin <- binNumAtLen(num.at.len = NLmfu2008$obs, len = NLmfu2008$length, bins = seq(0, 260, 5))
NLmfu2009bin <- binNumAtLen(num.at.len = NLmfu2009$obs, len = NLmfu2009$length, bins = seq(0, 260, 5))
NLmfu2010bin <- binNumAtLen(num.at.len = NLmfu2010$obs, len = NLmfu2010$length, bins = seq(0, 260, 5))
NLmfu2011bin <- binNumAtLen(num.at.len = NLmfu2011$obs, len = NLmfu2011$length, bins = seq(0, 260, 5))
NLmfu2012bin <- binNumAtLen(num.at.len = NLmfu2012$obs, len = NLmfu2012$length, bins = seq(0, 260, 5))
NLmfu2013bin <- binNumAtLen(num.at.len = NLmfu2013$obs, len = NLmfu2013$length, bins = seq(0, 260, 5))
NLmfu2014bin <- binNumAtLen(num.at.len = NLmfu2014$obs, len = NLmfu2014$length, bins = seq(0, 260, 5))
NLmfu2015bin <- binNumAtLen(num.at.len = NLmfu2015$obs, len = NLmfu2015$length, bins = seq(0, 260, 5))
NLmfu2016bin <- binNumAtLen(num.at.len = NLmfu2016$obs, len = NLmfu2016$length, bins = seq(0, 260, 5))
NLmfu2017bin <- binNumAtLen(num.at.len = NLmfu2017$obs, len = NLmfu2017$length, bins = seq(0, 260, 5))
NLmfu2018bin <- binNumAtLen(num.at.len = NLmfu2018$obs, len = NLmfu2018$length, bins = seq(0, 260, 5))
NLmfu2019bin <- binNumAtLen(num.at.len = NLmfu2019$obs, len = NLmfu2019$length, bins = seq(0, 260, 5))

NLmfu_binobs.tab <- data.frame(yr1996 = NLmfu1996bin, yr1997 = NLmfu1997bin, yr1998 = NLmfu1998bin, yr1999 = NLmfu1999bin, yr2000 = NLmfu2000bin, yr2001 = NLmfu2001bin, yr2002 = NLmfu2002bin, yr2003 = NLmfu2003bin, yr2004 = NLmfu2004bin, yr2005 = NLmfu2005bin, yr2006 = NLmfu2006bin, yr2007 = NLmfu2007bin, yr2008 = NLmfu2008bin, yr2009 = NLmfu2009bin, yr2010 = NLmfu2010bin, yr2011 = NLmfu2011bin, yr2012 = NLmfu2012bin, yr2013 = NLmfu2013bin, yr2014 = NLmfu2014bin, yr2015 = NLmfu2015bin, yr2016 = NLmfu2016bin, yr2017 = NLmfu2017bin, yr2018 = NLmfu2018bin, yr2019 = NLmfu2019bin)

NLmfu_binobs.tab <- tibble::rownames_to_column(NLmfu_binobs.tab, "length")

NLmfu_binobs.tab$length<-gsub("L"," ", as.character(NLmfu_binobs.tab$length))

NLmfu_binobs.tab$length <- as.numeric(NLmfu_binobs.tab$length)

NLmfu_binobs.tablong <- gather(NLmfu_binobs.tab, "year", "obs", -"length")
NLmfu_binobs.tablong$year<-gsub("yr"," ", as.character(NLmfu_binobs.tablong$year))

write.csv(NLmfu_binobs.tablong, "C:/Users/harperd/Documents/Halibut/GitDataInputs/NLsurvey_mfu_LF_obs.csv", row.names = FALSE)
#unsexed
NL_n_u <- NLstrat_length_abundance_detail %>% filter(sex == "unsexed")
NLu1996 <- NL_n_u %>% filter(survey.year == 1996)
NLu1997 <- NL_n_u %>% filter(survey.year == 1997)
NLu1998 <- NL_n_u %>% filter(survey.year == 1998)
NLu1999 <- NL_n_u %>% filter(survey.year == 1999)
NLu2000 <- NL_n_u %>% filter(survey.year == 2000)
NLu2001 <- NL_n_u %>% filter(survey.year == 2001)
NLu2002 <- NL_n_u %>% filter(survey.year == 2002)
NLu2003 <- NL_n_u %>% filter(survey.year == 2003)
NLu2004 <- NL_n_u %>% filter(survey.year == 2004)
NLu2005 <- NL_n_u %>% filter(survey.year == 2005)
NLu2006 <- NL_n_u %>% filter(survey.year == 2006)
NLu2007 <- NL_n_u %>% filter(survey.year == 2007)
NLu2008 <- NL_n_u %>% filter(survey.year == 2008)
NLu2009 <- NL_n_u %>% filter(survey.year == 2009)
NLu2010 <- NL_n_u %>% filter(survey.year == 2010)
NLu2011 <- NL_n_u %>% filter(survey.year == 2011)
NLu2012 <- NL_n_u %>% filter(survey.year == 2012)
NLu2013 <- NL_n_u %>% filter(survey.year == 2013)
NLu2014 <- NL_n_u %>% filter(survey.year == 2014)
NLu2015 <- NL_n_u %>% filter(survey.year == 2015)
NLu2016 <- NL_n_u %>% filter(survey.year == 2016)
NLu2017 <- NL_n_u %>% filter(survey.year == 2017)
NLu2018 <- NL_n_u %>% filter(survey.year == 2018)
NLu2019 <- NL_n_u %>% filter(survey.year == 2019)

NLu1996bin <- binNumAtLen(num.at.len = NLu1996$obs, len = NLu1996$length, bins = seq(0, 260, 5))
NLu1997bin <- binNumAtLen(num.at.len = NLu1997$obs, len = NLu1997$length, bins = seq(0, 260, 5))
NLu1998bin <- binNumAtLen(num.at.len = NLu1998$obs, len = NLu1998$length, bins = seq(0, 260, 5))
NLu1999bin <- binNumAtLen(num.at.len = NLu1999$obs, len = NLu1999$length, bins = seq(0, 260, 5))
NLu2000bin <- binNumAtLen(num.at.len = NLu2000$obs, len = NLu2000$length, bins = seq(0, 260, 5))
NLu2001bin <- binNumAtLen(num.at.len = NLu2001$obs, len = NLu2001$length, bins = seq(0, 260, 5))
NLu2002bin <- binNumAtLen(num.at.len = NLu2002$obs, len = NLu2002$length, bins = seq(0, 260, 5))
NLu2003bin <- binNumAtLen(num.at.len = NLu2003$obs, len = NLu2003$length, bins = seq(0, 260, 5))
NLu2004bin <- binNumAtLen(num.at.len = NLu2004$obs, len = NLu2004$length, bins = seq(0, 260, 5))
NLu2005bin <- binNumAtLen(num.at.len = NLu2005$obs, len = NLu2005$length, bins = seq(0, 260, 5))
NLu2006bin <- binNumAtLen(num.at.len = NLu2006$obs, len = NLu2006$length, bins = seq(0, 260, 5))
NLu2007bin <- binNumAtLen(num.at.len = NLu2007$obs, len = NLu2007$length, bins = seq(0, 260, 5))
NLu2008bin <- binNumAtLen(num.at.len = NLu2008$obs, len = NLu2008$length, bins = seq(0, 260, 5))
NLu2009bin <- binNumAtLen(num.at.len = NLu2009$obs, len = NLu2009$length, bins = seq(0, 260, 5))
NLu2010bin <- binNumAtLen(num.at.len = NLu2010$obs, len = NLu2010$length, bins = seq(0, 260, 5))
NLu2011bin <- binNumAtLen(num.at.len = NLu2011$obs, len = NLu2011$length, bins = seq(0, 260, 5))
NLu2012bin <- binNumAtLen(num.at.len = NLu2012$obs, len = NLu2012$length, bins = seq(0, 260, 5))
NLu2013bin <- binNumAtLen(num.at.len = NLu2013$obs, len = NLu2013$length, bins = seq(0, 260, 5))
NLu2014bin <- binNumAtLen(num.at.len = NLu2014$obs, len = NLu2014$length, bins = seq(0, 260, 5))
NLu2015bin <- binNumAtLen(num.at.len = NLu2015$obs, len = NLu2015$length, bins = seq(0, 260, 5))
NLu2016bin <- binNumAtLen(num.at.len = NLu2016$obs, len = NLu2016$length, bins = seq(0, 260, 5))
NLu2017bin <- binNumAtLen(num.at.len = NLu2017$obs, len = NLu2017$length, bins = seq(0, 260, 5))
NLu2018bin <- binNumAtLen(num.at.len = NLu2018$obs, len = NLu2018$length, bins = seq(0, 260, 5))
NLu2019bin <- binNumAtLen(num.at.len = NLu2019$obs, len = NLu2019$length, bins = seq(0, 260, 5))

NLu_binobs.tab <- data.frame(yr1996 = NLu1996bin, yr1997 = NLu1997bin, yr1998 = NLu1998bin, yr1999 = NLu1999bin, yr2000 = NLu2000bin, yr2001 = NLu2001bin, yr2002 = NLu2002bin, yr2003 = NLu2003bin, yr2004 = NLu2004bin, yr2005 = NLu2005bin, yr2006 = NLu2006bin, yr2007 = NLu2007bin, yr2008 = NLu2008bin, yr2009 = NLu2009bin, yr2010 = NLu2010bin, yr2011 = NLu2011bin, yr2012 = NLu2012bin, yr2013 = NLu2013bin, yr2014 = NLu2014bin, yr2015 = NLu2015bin, yr2016 = NLu2016bin, yr2017 = NLu2017bin, yr2018 = NLu2018bin, yr2019 = NLu2019bin)

NLu_binobs.tab <- tibble::rownames_to_column(NLu_binobs.tab, "length")

NLu_binobs.tab$length<-gsub("L"," ", as.character(NLu_binobs.tab$length))

NLu_binobs.tab$length <- as.numeric(NLu_binobs.tab$length)

NLu_binobs.tablong <- gather(NLmfu_binobs.tab, "year", "obs", -"length")
NLu_binobs.tablong$year<-gsub("yr"," ", as.character(NLu_binobs.tablong$year))

write.csv(NLu_binobs.tablong, "C:/Users/harperd/Documents/Halibut/GitDataInputs/NLsurvey_u_LF_obs.csv", row.names = FALSE)
```

